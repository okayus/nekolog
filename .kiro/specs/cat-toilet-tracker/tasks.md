# Implementation Plan

## Overview
NekoLog（猫トイレ記録アプリ）の実装タスク一覧。各タスクは PR 単位で管理可能なサイズに分割。

---

## Tasks

- [ ] 1. リポジトリ初期化と CI 基盤構築
- [x] 1.1 GitHub パブリックリポジトリの作成とモノレポ基盤セットアップ
  - GitHub にパブリックリポジトリを作成
  - pnpm workspace と Turborepo の初期設定
  - ルートの package.json、pnpm-workspace.yaml、turbo.json を作成
  - 共通の tsconfig.base.json を作成
  - .gitignore、.nvmrc（Node 20）を追加
  - _Requirements: N/A（インフラ基盤）_

- [ ] 1.2 GitHub Actions CI ワークフローの構築（プレースホルダーテスト）
  - .github/workflows/ci.yml を作成
  - pnpm install と Turborepo キャッシュの設定
  - プレースホルダーとして常に成功する簡単なテストを追加
  - PR 作成時に CI が動作することを確認
  - _Requirements: N/A（インフラ基盤）_

- [ ] 2. 共有パッケージのセットアップ
- [ ] 2.1 (P) packages/shared の初期化と型定義
  - packages/shared パッケージを作成
  - Zod をインストールし共通スキーマを定義
  - Cat、ToiletLog、User の型定義を作成
  - API リクエスト/レスポンス型を定義
  - _Requirements: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 3.4_

- [ ] 2.2 共有パッケージのユニットテスト追加
  - Vitest をセットアップ
  - Zod スキーマのバリデーションテストを追加
  - CI で `pnpm turbo test` が実行されることを確認
  - _Requirements: 2.2, 3.2_

- [ ] 3. バックエンド API 基盤構築
- [ ] 3.1 apps/api の初期化と Hono セットアップ
  - apps/api パッケージを作成
  - Hono v4 をインストール
  - Cloudflare Workers 用の wrangler.toml を作成
  - ヘルスチェック用の `/api/health` エンドポイントを実装
  - AppType を export して RPC の型共有基盤を作成
  - _Requirements: N/A（インフラ基盤）_

- [ ] 3.2 Drizzle ORM と D1 データベース設定
  - Drizzle ORM をインストールし設定
  - D1 用のスキーマ定義（users, cats, toilet_logs テーブル）
  - drizzle-kit でマイグレーションファイルを生成
  - ローカル開発用の D1 バインディング設定
  - _Requirements: 2.1, 2.6, 3.1, 3.7_

- [ ] 3.3 Clerk 認証ミドルウェアの統合
  - @hono/clerk-auth をインストール
  - 認証ミドルウェアを実装し全 API ルートを保護
  - 認証済みユーザーの userId を取得する仕組みを実装
  - 未認証リクエストに 401 を返す動作を確認
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_

- [ ] 4. 猫管理 API の実装
- [ ] 4.1 (P) 猫の CRUD API エンドポイント実装
  - GET /api/cats（一覧取得）
  - GET /api/cats/:id（詳細取得）
  - POST /api/cats（新規作成、名前必須バリデーション）
  - PUT /api/cats/:id（更新）
  - DELETE /api/cats/:id（削除、関連トイレ記録のカスケード削除）
  - _Requirements: 2.1, 2.2, 2.4, 2.5, 2.6_

- [ ] 4.2 (P) 猫の画像アップロード機能（R2 統合）
  - POST /api/cats/:id/image エンドポイント実装
  - R2 バケットへの画像保存処理
  - 画像 URL の cats テーブルへの保存
  - ファイルサイズ・形式のバリデーション
  - _Requirements: 2.3_

- [ ] 5. トイレ記録 API の実装
- [ ] 5.1 トイレ記録の CRUD API エンドポイント実装
  - GET /api/logs（一覧取得、フィルタリング・ページネーション対応）
  - GET /api/logs/:id（詳細取得）
  - POST /api/logs（新規作成、種類・日時・メモの保存）
  - PUT /api/logs/:id（更新）
  - DELETE /api/logs/:id（削除）
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.6, 3.7, 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 6. 統計 API の実装
- [ ] 6.1 ダッシュボード用統計 API エンドポイント実装
  - GET /api/stats/summary（本日の全猫サマリー）
  - GET /api/stats/chart（期間別・猫別のチャートデータ）
  - 日別・週別・月別の集計ロジック
  - 排尿・排便の区別した集計
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 7. フロントエンド基盤構築
- [ ] 7.1 apps/web の初期化と React + Vite セットアップ
  - apps/web パッケージを作成
  - Vite + React + TypeScript の設定
  - Tailwind CSS と shadcn/ui のセットアップ
  - Hono Client (hc) の設定と AppType の型インポート
  - _Requirements: 6.1, 6.2_

- [ ] 7.2 TanStack Query と API クライアントの設定
  - TanStack Query v5 のプロバイダー設定
  - Hono RPC クライアントの初期化
  - 共通のエラーハンドリング設定
  - _Requirements: N/A（インフラ基盤）_

- [ ] 7.3 Clerk 認証 UI の統合
  - @clerk/clerk-react のセットアップ
  - ClerkProvider の設定
  - ログインページとサインインコンポーネント
  - 認証状態に応じたルーティング（ProtectedRoute）
  - ヘッダーにログアウトボタンを配置
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 8. 猫管理 UI の実装
- [ ] 8.1 猫一覧・登録画面の実装
  - 猫一覧ページ（CatsPage）の作成
  - 猫カード コンポーネント（名前、写真、基本情報表示）
  - 猫登録フォーム（名前必須、オプション項目）
  - 画像アップロード UI
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [ ] 8.2 猫編集・削除機能の実装
  - 猫編集フォーム
  - 削除確認ダイアログ
  - 削除時の関連データ削除の警告表示
  - _Requirements: 2.5, 2.6_

- [ ] 9. トイレ記録 UI の実装
- [ ] 9.1 クイック記録フォームの実装
  - トイレ記録追加フォーム（LogForm）
  - 猫選択ドロップダウン
  - 排尿/排便のトグルボタン
  - 日時ピッカー（デフォルト現在時刻）
  - メモ入力欄（オプション）
  - 保存成功時のトースト通知
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 6.3_

- [ ] 9.2 記録履歴ページの実装
  - 履歴一覧ページ（HistoryPage）
  - 時系列での記録表示
  - 猫・期間・種類でのフィルタリング UI
  - ページネーション
  - 記録の編集・削除機能
  - _Requirements: 3.6, 3.7, 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 10. ダッシュボード UI の実装
- [ ] 10.1 ダッシュボードサマリーの実装
  - ダッシュボードページ（DashboardPage）
  - 本日の全猫トイレ回数サマリー表示
  - 猫ごとの排尿・排便回数カード
  - _Requirements: 4.1, 4.3_

- [ ] 10.2 統計グラフの実装
  - Recharts による折れ線グラフ（動的インポート）
  - 期間セレクター（日別/週別/月別）
  - 猫選択による詳細統計表示
  - _Requirements: 4.2, 4.4, 4.5, 4.6_

- [ ] 11. レスポンシブ対応とオフライン通知
- [ ] 11.1 モバイル最適化
  - 全ページのモバイルレスポンシブ対応
  - タッチ操作に最適化したUI調整
  - クイック記録ボタンのモバイル配置
  - _Requirements: 6.1, 6.2, 6.3_

- [ ] 11.2 (P) オフライン状態の通知
  - ネットワーク状態の検知
  - オフライン時のバナー表示
  - _Requirements: 6.4_

- [ ] 12. 本番デプロイ設定
- [ ] 12.1 Cloudflare リソースのセットアップ
  - D1 データベースの作成（本番環境）
  - R2 バケットの作成
  - 環境変数とシークレットの設定
  - _Requirements: N/A（インフラ基盤）_

- [ ] 12.2 GitHub Actions デプロイワークフローの構築
  - .github/workflows/deploy.yml の作成
  - main ブランチマージ時の自動デプロイ
  - Workers と Pages の両方をデプロイ
  - _Requirements: N/A（インフラ基盤）_

- [ ] 13. 統合テストと最終確認
- [ ] 13.1 E2E テストの実装
  - Playwright のセットアップ
  - ログイン → ダッシュボード表示のテスト
  - 猫登録 → トイレ記録 → 統計確認のフローテスト
  - _Requirements: 1.1, 1.2, 2.1, 3.1, 4.1_

- [ ] 13.2 全機能の統合確認
  - 全 API エンドポイントの動作確認
  - 認証フローの E2E 確認
  - モバイル・デスクトップでの表示確認
  - _Requirements: All_

---

## Requirements Coverage

| Requirement | Tasks |
|-------------|-------|
| 1.1 | 3.3, 7.3, 13.1 |
| 1.2 | 3.3, 7.3, 13.1 |
| 1.3 | 3.3, 7.3 |
| 1.4 | 3.3, 7.3 |
| 1.5 | 3.3, 7.3 |
| 1.6 | 3.3 |
| 2.1 | 2.1, 3.2, 4.1, 8.1, 13.1 |
| 2.2 | 2.1, 2.2, 4.1, 8.1 |
| 2.3 | 2.1, 4.2, 8.1 |
| 2.4 | 4.1, 8.1 |
| 2.5 | 4.1, 8.2 |
| 2.6 | 3.2, 4.1, 8.2 |
| 3.1 | 2.1, 3.2, 5.1, 9.1, 13.1 |
| 3.2 | 2.1, 2.2, 5.1, 9.1 |
| 3.3 | 2.1, 5.1, 9.1 |
| 3.4 | 2.1, 5.1, 9.1 |
| 3.5 | 9.1 |
| 3.6 | 5.1, 9.2 |
| 3.7 | 3.2, 5.1, 9.2 |
| 4.1 | 6.1, 10.1, 13.1 |
| 4.2 | 6.1, 10.2 |
| 4.3 | 6.1, 10.1 |
| 4.4 | 6.1, 10.2 |
| 4.5 | 6.1, 10.2 |
| 4.6 | 10.2 |
| 5.1 | 5.1, 9.2 |
| 5.2 | 5.1, 9.2 |
| 5.3 | 5.1, 9.2 |
| 5.4 | 5.1, 9.2 |
| 5.5 | 5.1, 9.2 |
| 6.1 | 7.1, 11.1 |
| 6.2 | 7.1, 11.1 |
| 6.3 | 9.1, 11.1 |
| 6.4 | 11.2 |
