# レビュー観点: コードは「意味」を表現しているか

以下の観点でレビューすること。

## 1. ドメインモデル（型）
- 名詞・概念がプリミティブ（`string`, `number`）のまま放置されず、意味のある型で表現されているか。
- 識別子・状態・単位・時刻など、取り違えると事故る値が別型で区別されているか。
- `null`/`undefined` の意味が曖昧でないか（「未設定」「不明」「存在しない」が型で区別されているか）。

## 2. 代数的データ型（ADT）
- 状態や結果がブール値や文字列フラグ乱立ではなく、Union/Discriminated Union で閉じた集合として表現されているか。
- `switch`/`match` で網羅性が担保され、未処理ケースがコンパイル時に検知されるか。
- 失敗・例外系が `Result`/`Either` 相当で明示され、例外投げっぱなしになっていないか。

## 3. 制約（不変条件）
- バリデーションが境界（API/Repository 入出力）に集約され、ドメイン層で不正値を受け取らない設計か。
- 「起こりえない状態」が型で表現不能になっているか（実行時チェック頼みになっていないか）。
- 業務ルール（例: 必須確認、上限、相関制約）がユースケース内に明示され、散在していないか。

## 4. ユースケース
- ユースケースの入出力型だけで意図が読めるか（副作用や依存が引数/戻り値に表れているか）。
- 1ユースケース1責務になっているか（I/O変換・検証・永続化・副作用が無秩序に混ざっていないか）。
- エラー種別がユースケース境界で安定しており、上位層でHTTP等に機械的変換できるか。

## 5. テスト（意味の保証）
- 実装詳細ではなく仕様・不変条件を検証しているか。
- 正常系だけでなく、境界値・不正値・遷移不正・権限違反など意味上重要な失敗系があるか。
- プロパティがある領域は性質ベース（例: round-trip、単調性、保存則）のテストを検討しているか。
- テスト名が「何を保証する仕様か」を表しているか。

## 6. レビュー時の出力フォーマット
レビュー結果は次の3区分で提示すること。
- **Blocker**: 意味モデルを壊す欠陥（型で防げるのに防いでいない、制約漏れ等）
- **Should**: 設計の明確性を上げる改善（ADT化、エラー型の整理、境界の集約等）
- **Nit**: 可読性・命名・テスト記述の軽微改善

各指摘には必ず以下を含めること。
- どの意味（業務ルール/不変条件）が欠けているか
- なぜ型・ADT・制約・テストで表現すべきか
- 最小の修正方針（1〜3手）

## 7. PRコメント投稿の運用ルール（改行崩れ防止）
- `gh pr comment --body '...'` のようにインライン文字列を直接渡さない。
- 先に `/home/okayu/dev/nekolog/for-copilot` 配下に下書きの Markdown ファイルを作成する。
- 投稿時は `gh pr comment <PR番号> --body-file <下書きmdのパス>` を必ず使う。
- レビューコメント（`gh pr review --comment` 等）でも同様に `--body-file` を優先し、改行コードやエスケープ文字が本文に混入しないようにする。
